<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="redcapcustodian">
<title>REDCap Custodian Friday Call Demo Credentials Setup • redcapcustodian</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="REDCap Custodian Friday Call Demo Credentials Setup">
<meta property="og:description" content="redcapcustodian">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">redcapcustodian</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.14.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/credential-scraping.html">Credential Scraping</a>
    <a class="dropdown-item" href="../articles/custom_rscript.html">Custom Rscript</a>
    <a class="dropdown-item" href="../articles/delete-erroneous-survey-reminders.html">Deleting Erroneous Survey Reminders</a>
    <a class="dropdown-item" href="../articles/developer_notes.html">Developer Notes for REDCap Custodian</a>
    <a class="dropdown-item" href="../articles/expire_user_project_rights.html">expire_user_project_rights</a>
    <a class="dropdown-item" href="../articles/friday-call-demo-setup.html">REDCap Custodian Friday Call Demo Credentials Setup</a>
    <a class="dropdown-item" href="../articles/friday-call-demo.html">REDCap Custodian Friday Call Demo</a>
    <a class="dropdown-item" href="../articles/randomization-management.html">Randomization Management</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ctsit/redcapcustodian/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>REDCap Custodian Friday Call Demo Credentials Setup</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctsit/redcapcustodian/blob/HEAD/vignettes/friday-call-demo-setup.Rmd" class="external-link"><code>vignettes/friday-call-demo-setup.Rmd</code></a></small>
      <div class="d-none name"><code>friday-call-demo-setup.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>These are the setup instructions for a demonstration of some features
of the REDCap Custodian R package.</p>
<p>In these setup steps, we will demonstrate how to:</p>
<ol style="list-style-type: decimal">
<li>Create a local credentials database</li>
<li>Fetch and store your API tokens in the credentials database</li>
<li>Create an load some fake data into the REDCap projects we want to
test with.</li>
</ol>
<p>All of this is a prelude to a demonstration of moving data between
REDCap projects described in
<code><a href="../articles/friday-call-demo.html">vignette("friday-call-demo")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="prequisites">Prequisites<a class="anchor" aria-label="anchor" href="#prequisites"></a>
</h2>
<p>If you want to do this yourself, we recommend you do these things to
setup your development and testing environment:</p>
<ol style="list-style-type: decimal">
<li>Install R, Rstudio, and the tidyverse packages</li>
<li>Install redcapcustodian from github</li>
<li>Clone the <a href="https://github.com/123andy/redcap-docker-compose/" class="external-link">redcap-docker-compose</a>
git repo</li>
<li>Create a local REDCap with redcap-docker-compose</li>
<li>Create an new project in Rstudio. Note this is an <em>R</em>
project, not a <em>REDCap</em> project,</li>
<li>Copy <a href="https://github.com/ctsit/redcapcustodian/tree/master/vignettes/local.env.txt" class="external-link">local.env.txt</a>
to .env in the root of your new project folder.</li>
</ol>
<p>You also need some REDCap projects to play with. If you have your
own, that’s great. for our demo, we need two REDCap projects to exist.
Please make those projects with these XML files: <a href="https://github.com/ctsit/redcapcustodian/tree/master/vignettes/main.xml" class="external-link">main</a>
<a href="https://github.com/ctsit/redcapcustodian/tree/master/vignettes/biospecimen.xml" class="external-link">biospecimen</a>.</p>
<p>Name the project from <code>main.xml</code>: “Demo Main” Name the
project from <code>biospecimen.xml</code>: “Demo Biospecimen”</p>
<p>To talk to those projects from code, they’ll need API tokens. Add
those to the main and biospecimen projects. Do the same for any other
project you want to play with.</p>
<p>With those changes in place, you can start developing scripts that
use REDCap Custodian.</p>
</div>
<div class="section level2">
<h2 id="fetch-and-store-api-tokens">Fetch and store API Tokens<a class="anchor" aria-label="anchor" href="#fetch-and-store-api-tokens"></a>
</h2>
<p>First, load some R packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ctsit.github.io/redcapcustodian/" class="external-link">redcapcustodian</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaborcsardi/dotenv" class="external-link">dotenv</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span></code></pre></div>
<p>Then, make a database to hold the credentials:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"credentials"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># creates file if one does not exist</span></span>
<span><span class="va">file_conn</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"credentials/credentials.db"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># SQLite friendly schema</span></span>
<span><span class="va">credentials_sql</span> <span class="op">&lt;-</span> <span class="st">"CREATE TABLE IF NOT EXISTS `credentials` (</span></span>
<span><span class="st">  `redcap_uri` TEXT NOT NULL,</span></span>
<span><span class="st">  `server_short_name` varchar(128) NOT NULL,</span></span>
<span><span class="st">  `username` varchar(191) NOT NULL,</span></span>
<span><span class="st">  `project_id` int(10) NOT NULL,</span></span>
<span><span class="st">  `project_display_name` TEXT NOT NULL,</span></span>
<span><span class="st">  `project_short_name` varchar(128) DEFAULT NULL,</span></span>
<span><span class="st">  `token` varchar(64) NOT NULL,</span></span>
<span><span class="st">  `comment` varchar(256) DEFAULT NULL</span></span>
<span><span class="st">);</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">file_conn</span>, <span class="va">credentials_sql</span><span class="op">)</span></span></code></pre></div>
<p>Now, fetch all of your API tokens and write them into your local
credentials DB.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fetching all extant API tokens and adding them to storage #################</span></span>
<span><span class="fu">load_dot_env</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"local.env.txt"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_username</span> <span class="op">&lt;-</span> <span class="st">"admin"</span></span>
<span><span class="va">source_conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_to_redcap_db.html">connect_to_redcap_db</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">scraped_credentials</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scrape_user_api_tokens.html">scrape_user_api_tokens</a></span><span class="op">(</span><span class="va">source_conn</span>, <span class="va">my_username</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># alter credentials to match local schema</span></span>
<span><span class="va">source_credentials_upload</span> <span class="op">&lt;-</span> <span class="va">scraped_credentials</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    redcap_uri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"URI"</span><span class="op">)</span>,</span>
<span>    server_short_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"INSTANCE"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># remove duplicates</span></span>
<span>  <span class="fu">anti_join</span><span class="op">(</span></span>
<span>    <span class="fu">tbl</span><span class="op">(</span><span class="va">file_conn</span>, <span class="st">"credentials"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbAppendTable.html" class="external-link">dbAppendTable</a></span><span class="op">(</span><span class="va">file_conn</span>, <span class="st">"credentials"</span>, <span class="va">source_credentials_upload</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="make-test-data-and-write-it-to-your-test-projects">Make test data and write it to your test projects<a class="anchor" aria-label="anchor" href="#make-test-data-and-write-it-to-your-test-projects"></a>
</h2>
<p>We will generate some records for your main project for you to port
over to the Biospecimen project. First, access the credential database
to get your credentials to the REDCap project you want to read from.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">source_credentials</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">file_conn</span>, <span class="st">"credentials"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">username</span> <span class="op">==</span> <span class="va">my_username</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">project_display_name</span>, <span class="st">"Demo Main"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We use Will Beasley’s REDCapR library to interact with REDCap via its
API. REDCapR allows you to specify the forms, fields, event names, and
time frames of interest. It even allows REDCap filtering.</p>
<p>It isn’t necessary to understand most of the following block as you
typically won’t be populating a project with random data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">record_count_to_create</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">collection_events</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">tubes_per_collection</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span></span>
<span><span class="va">record_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"record_id"</span>,</span>
<span>  <span class="st">"redcap_event_name"</span>,</span>
<span>  <span class="st">"sample_collected_date"</span>,</span>
<span>  <span class="st">"tmp_event_id"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"tube_id"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">tubes_per_collection</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"tube_specimen_type"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">tubes_per_collection</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"tube_volume"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">tubes_per_collection</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># create empty dataframe and set column names</span></span>
<span><span class="va">simulated_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">record_columns</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">simulated_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">record_columns</span></span>
<span></span>
<span><span class="co"># create base entries for each event</span></span>
<span><span class="co"># NOTE: may be a bit slow as for-loops are not generally used in R</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">record_id</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">record_count_to_create</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">event_id</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">collection_events</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">simulated_data</span> <span class="op">&lt;-</span> <span class="va">simulated_data</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">add_row</span><span class="op">(</span></span>
<span>        record_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">record_id</span><span class="op">)</span>,</span>
<span>        redcap_event_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"event_"</span>, <span class="va">event_id</span>, <span class="st">"_arm_1"</span><span class="op">)</span>,</span>
<span>        tmp_event_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">event_id</span><span class="op">)</span>, <span class="co"># used to generate tube IDs later</span></span>
<span>        sample_collected_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-06-01"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, replace <span class="op">=</span> <span class="cn">T</span></span>
<span>        <span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># group to ensure simulated data is consistent with a single collection event</span></span>
<span><span class="va">simulated_data</span> <span class="op">&lt;-</span> <span class="va">simulated_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">record_id</span>, <span class="va">redcap_event_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate individual samples</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">tube</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">tubes_per_collection</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">simulated_data</span> <span class="op">&lt;-</span> <span class="va">simulated_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span></span>
<span>      <span class="st">"tube_id{tube}"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>        <span class="va">record_id</span>, <span class="st">"-"</span>,</span>
<span>        <span class="fu">str_pad</span><span class="op">(</span><span class="va">tmp_event_id</span>, width <span class="op">=</span> <span class="fl">2</span>, side <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span>, <span class="st">"-"</span>,</span>
<span>        <span class="fu">str_pad</span><span class="op">(</span><span class="va">tube</span>, width <span class="op">=</span> <span class="fl">2</span>, side <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="st">"tube_specimen_type{tube}"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      <span class="st">"tube_volume{tube}"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># remove temporary column used in simulation</span></span>
<span><span class="va">simulated_data</span> <span class="op">&lt;-</span> <span class="va">simulated_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">tmp_event_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># upload data to REDCap</span></span>
<span><span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="https://ouhscbbmc.github.io/REDCapR/reference/redcap_write.html" class="external-link">redcap_write</a></span><span class="op">(</span></span>
<span>  redcap_uri <span class="op">=</span> <span class="va">source_credentials</span><span class="op">$</span><span class="va">redcap_uri</span>,</span>
<span>  token <span class="op">=</span> <span class="va">source_credentials</span><span class="op">$</span><span class="va">token</span>,</span>
<span>  ds_to_write <span class="op">=</span> <span class="va">simulated_data</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Philip Chase, Laurence James-Woodley, Kyle Chesney, Michael Bentz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
