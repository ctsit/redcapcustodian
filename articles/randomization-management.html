<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="redcapcustodian">
<title>Randomization Management • redcapcustodian</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Randomization Management">
<meta property="og:description" content="redcapcustodian">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">redcapcustodian</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.14.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/credential-scraping.html">Credential Scraping</a>
    <a class="dropdown-item" href="../articles/custom_rscript.html">Custom Rscript</a>
    <a class="dropdown-item" href="../articles/delete-erroneous-survey-reminders.html">Deleting Erroneous Survey Reminders</a>
    <a class="dropdown-item" href="../articles/developer_notes.html">Developer Notes for REDCap Custodian</a>
    <a class="dropdown-item" href="../articles/expire_user_project_rights.html">expire_user_project_rights</a>
    <a class="dropdown-item" href="../articles/friday-call-demo-setup.html">REDCap Custodian Friday Call Demo Credentials Setup</a>
    <a class="dropdown-item" href="../articles/friday-call-demo.html">REDCap Custodian Friday Call Demo</a>
    <a class="dropdown-item" href="../articles/randomization-management.html">Randomization Management</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ctsit/redcapcustodian/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Randomization Management</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctsit/redcapcustodian/blob/HEAD/vignettes/randomization-management.Rmd" class="external-link"><code>vignettes/randomization-management.Rmd</code></a></small>
      <div class="d-none name"><code>randomization-management.Rmd</code></div>
    </div>

    
    
<p>REDCap Custodian contains a suite of functions to help a developer
work with randomization data in ways that are not supported within the
REDCap code.</p>
<div class="section level2">
<h2 id="moving-a-production-project-with-allocated-randomization-records">Moving a Production project with allocated randomization
records<a class="anchor" aria-label="anchor" href="#moving-a-production-project-with-allocated-randomization-records"></a>
</h2>
<p>These tools were created to allow a production project with
randomization turned on to be moved to another REDCap project. REDCap
doesn’t allow that, so the work has to be done in the backend with
database reads and write. As the tables involved have REDCap project
IDs, randomization IDs, eventIDs, and allocations IDs embedded, the work
requires multiple transformations before writing the randomization
configuration to the target project.</p>
<p>An example of how to use randomization management functions to copy
allocated randomizations is shown here.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ctsit.github.io/redcapcustodian/" class="external-link">redcapcustodian</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaborcsardi/dotenv" class="external-link">dotenv</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/init_etl.html">init_etl</a></span><span class="op">(</span><span class="st">"copy_allocated_randomization"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">source_conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_to_redcap_db.html">connect_to_redcap_db</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># specify a second database connection if the target project is on another host</span></span>
<span><span class="va">target_conn</span> <span class="op">&lt;-</span> <span class="va">source_conn</span></span>
<span><span class="va">source_project_id</span> <span class="op">&lt;-</span> <span class="fl">18</span></span>
<span><span class="va">target_project_id</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span></span>
<span><span class="co"># get and print importable allocations if we need them for reference</span></span>
<span><span class="va">allocations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export_allocation_tables_from_project.html">export_allocation_tables_from_project</a></span><span class="op">(</span></span>
<span>  conn <span class="op">=</span> <span class="va">source_conn</span>,</span>
<span>  project_id_to_export <span class="op">=</span> <span class="va">source_project_id</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">target_directory</span> <span class="op">=</span> <span class="st">"output"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_access.html" class="external-link">dir_exists</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="va">target_directory</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="va">target_directory</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">walk</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">write_allocations</span>, <span class="va">allocations</span>, <span class="va">target_directory</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Configure randomization on the target project</span></span>
<span><span class="va">target_project_randomization_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_randomization_row.html">create_randomization_row</a></span><span class="op">(</span></span>
<span>    source_conn <span class="op">=</span> <span class="va">source_conn</span>,</span>
<span>    target_conn <span class="op">=</span> <span class="va">target_conn</span>,</span>
<span>    source_project_id <span class="op">=</span> <span class="va">source_project_id</span>,</span>
<span>    target_project_id <span class="op">=</span> <span class="va">target_project_id</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">target_project_allocation_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_allocation_rows.html">create_allocation_rows</a></span><span class="op">(</span></span>
<span>  source_conn <span class="op">=</span> <span class="va">source_conn</span>,</span>
<span>  target_conn <span class="op">=</span> <span class="va">target_conn</span>,</span>
<span>  source_project_id <span class="op">=</span> <span class="va">source_project_id</span>,</span>
<span>  target_project_id <span class="op">=</span> <span class="va">target_project_id</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Update randomization on the target project</span></span>
<span><span class="va">target_project_allocation_update</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/update_production_allocation_state.html">update_production_allocation_state</a></span><span class="op">(</span></span>
<span>  source_conn <span class="op">=</span> <span class="va">source_conn</span>,</span>
<span>  target_conn <span class="op">=</span> <span class="va">target_conn</span>,</span>
<span>  source_project_id <span class="op">=</span> <span class="va">source_project_id</span>,</span>
<span>  target_rid <span class="op">=</span> <span class="va">target_project_randomization_state</span><span class="op">$</span><span class="va">rid</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Enable randomization on the target</span></span>
<span><span class="fu"><a href="../reference/enable_randomization_on_a_preconfigured_project_in_production.html">enable_randomization_on_a_preconfigured_project_in_production</a></span><span class="op">(</span></span>
<span>  target_conn <span class="op">=</span> <span class="va">target_conn</span>,</span>
<span>  target_project_id <span class="op">=</span> <span class="va">target_project_id</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This script and the functions in it calls were designed to fit into
this workflow:</p>
<div class="section level3">
<h3 id="preparation">Preparation<a class="anchor" aria-label="anchor" href="#preparation"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Start with a production project with randomization turned on and
configured, data entered and records randomized. This is the <em>source
project</em>. Note its project ID.</li>
<li>Copy/clone the source project. Either use the <em>Copy the
Project</em> button in REDCap Project Setup, or do an XML export and an
import. This new project is the <em>target project</em>. Note its
project ID.</li>
<li>Turn off randomization in the target project if the copy/cloning
process turned it on. This probably seems strange, but it’s needed to
allow data import into the randomization field and to trick REDCap into
moving the project to production with data in the “randomization” field
and the assignments in the allocation table.</li>
<li>Do any reconfiguration work needed on the target project. You should
be able to move the fields to other forms and to other events if needed.
That said, do not change the names of the stratification and
randomization fields.</li>
<li>Copy the script above and set your own values for source and target
project ids.</li>
<li>Run your <code>copy_allocated_randomization.R</code> script. It
should mirror the randomization configuration from the source project to
the target project. If you cloned the project with the <em>Copy the
Project</em> button, the script will complain that some configuration
data exists. That is fine. Regardless how you cloned the project, the
script should complain that you have not met the requirements for turn
on randomization. You are <em>supposed</em> to see that warning at this
point.</li>
</ol>
</div>
<div class="section level3">
<h3 id="activation">Activation<a class="anchor" aria-label="anchor" href="#activation"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Take the source project offline.</li>
<li>If any changes have occurred to the data in the source project since
you cloned it, re-export that data from the source project and import it
into the target project.</li>
<li>Immediately move the target project to production.</li>
<li>Immediately re-run your <code>copy_allocated_randomization.R</code>
script. It should turn on randomization in the target project.</li>
<li>Revoke access to the source project.</li>
<li>You are done.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<p>These randomization management tools do not support DAG group_ids as
randomization variables. They could, but they don’t as they were not
needed for the project that inspired these tools. Do not try to use
these on a project that uses DAGs in the randomization
configuration.</p>
<p>The tools do not support changing the randomization configuration.
They might form a good foundation for that, but they do not support
it.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Philip Chase, Laurence James-Woodley, Kyle Chesney, Michael Bentz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
