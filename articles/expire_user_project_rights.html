<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="redcapcustodian">
<title>expire_user_project_rights • redcapcustodian</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="expire_user_project_rights">
<meta property="og:description" content="redcapcustodian">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">redcapcustodian</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.14.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/credential-scraping.html">Credential Scraping</a>
    <a class="dropdown-item" href="../articles/custom_rscript.html">Custom Rscript</a>
    <a class="dropdown-item" href="../articles/delete-erroneous-survey-reminders.html">Deleting Erroneous Survey Reminders</a>
    <a class="dropdown-item" href="../articles/developer_notes.html">Developer Notes for REDCap Custodian</a>
    <a class="dropdown-item" href="../articles/expire_user_project_rights.html">expire_user_project_rights</a>
    <a class="dropdown-item" href="../articles/friday-call-demo-setup.html">REDCap Custodian Friday Call Demo Credentials Setup</a>
    <a class="dropdown-item" href="../articles/friday-call-demo.html">REDCap Custodian Friday Call Demo</a>
    <a class="dropdown-item" href="../articles/randomization-management.html">Randomization Management</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ctsit/redcapcustodian/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>expire_user_project_rights</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctsit/redcapcustodian/blob/HEAD/vignettes/expire_user_project_rights.Rmd" class="external-link"><code>vignettes/expire_user_project_rights.Rmd</code></a></small>
      <div class="d-none name"><code>expire_user_project_rights.Rmd</code></div>
    </div>

    
    
<p>When a study that uses REDCap closes out, you might need to do a bit
of clean up. One important task is to expire people’s access to the
REDCap project(s) used in the study. If it was a bug study with multiple
projects and a large data entry team, that might be a difficult task.
<code><a href="../reference/expire_user_project_rights.html">expire_user_project_rights()</a></code> was written to address that
exact problem.</p>
<p>If you need to do the same, write an RScript something like this to
get the job done.</p>
<p>First, load the required packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaborcsardi/dotenv" class="external-link">dotenv</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ctsit.github.io/redcapcustodian/" class="external-link">redcapcustodian</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmariadb.r-dbi.org" class="external-link">RMariaDB</a></span><span class="op">)</span></span></code></pre></div>
<p>You’ll need to read credentials for your REDCap database from an
environment file. There’s no API call do do this kind of user
manipulation, so you’ll need to to write directly to the backend. The
config block you’ll need in the environment file looks like this:</p>
<pre><code>URI=http://localhost:11203/api/
REDCAP_DB_PORT=21203
REDCAP_DB_NAME=redcap
REDCAP_DB_HOST=127.0.0.1
REDCAP_DB_USER=redcap
REDCAP_DB_PASSWORD=redcap123</code></pre>
<p>When you are writing to REDCap, you should log your work. REDCap
Custodian can do that for you with just a little effort on your part. To
make that possible you’ll need database credentials for logging in your
environment file as well. They look like this:</p>
<pre><code>LOG_DB_NAME=rcc_log
LOG_DB_HOST=127.0.0.1
LOG_DB_USER=rcc_log
LOG_DB_PASSWORD=password
LOG_DB_PORT=3306</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">load_dot_env</span><span class="op">(</span><span class="st">"redcap_server.env"</span><span class="op">)</span></span></code></pre></div>
<p>With the your REDCap and logging database parameters avaiable, you
can connect to the those DBs. <code>init_etl</code> will create a
connection to the logging database so you are prepared to log your
work–or failure of that happens.</p>
<p><code><a href="../reference/connect_to_redcap_db.html">connect_to_redcap_db()</a></code> Does just that uses the
parameters from the environment file.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/init_etl.html">init_etl</a></span><span class="op">(</span><span class="st">"expire_stp_users"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_to_redcap_db.html">connect_to_redcap_db</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/expire_user_project_rights.html">expire_user_project_rights()</a></code> allows you to exclude a lit
of usernames from its expiration work. These might be your REDCap
admins, the statistician, or someone else who still needs to work with
the project.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_users_except</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"pbc"</span>,</span>
<span>  <span class="st">"tls"</span>,</span>
<span>  <span class="st">"cpb"</span>,</span>
<span>  <span class="st">"mbentz"</span>,</span>
<span>  <span class="st">"kyle.chesney"</span>,</span>
<span>  <span class="st">"lawjames1"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Make sure to specify a list of project IDs whose users rights need to
be expired. It can be 1 or many. You don’t need to specify and
expiration date. If you omit it, the script defaults today, revoking
access at midnight.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expire_user_project_rights.html">expire_user_project_rights</a></span><span class="op">(</span></span>
<span>  conn <span class="op">=</span> <span class="va">conn</span>,</span>
<span>  project_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">26</span>, <span class="fl">31</span>, <span class="fl">34</span>, <span class="fl">45</span>, <span class="fl">62</span>, <span class="fl">65</span>, <span class="fl">27</span>, <span class="fl">33</span>, <span class="fl">40</span>, <span class="fl">41</span>, <span class="fl">73</span><span class="op">)</span>,</span>
<span>  all_users_except <span class="op">=</span> <span class="va">all_users_except</span>,</span>
<span>  expiration_date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">today</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">ddays</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>expire_user_project_rights</code> returns a list with the
number of records revised and the dataframe of updates that was applied
to the redcap_user_rights table.</p>
<p>It is easy to transform that into a JSON object and then pass that to
<code>log_job_success</code> which will put that JSON object into the
summary field of the log record.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/log_job_success.html">log_job_success</a></span><span class="op">(</span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here’s the entire script, but you’ll need to use write your own user
exclusions and list of project IDs. Be careful with those project IDs.
There is no check that you typed the right ID.</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaborcsardi/dotenv" class="external-link">dotenv</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ctsit.github.io/redcapcustodian/" class="external-link">redcapcustodian</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmariadb.r-dbi.org" class="external-link">RMariaDB</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">load_dot_env</span><span class="op">(</span><span class="st">"redcap_server.env"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/init_etl.html">init_etl</a></span><span class="op">(</span><span class="st">"expire_study_users"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_to_redcap_db.html">connect_to_redcap_db</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_users_except</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"pbc"</span>,</span>
<span>  <span class="st">"tls"</span>,</span>
<span>  <span class="st">"cpb"</span>,</span>
<span>  <span class="st">"mbentz"</span>,</span>
<span>  <span class="st">"kyle.chesney"</span>,</span>
<span>  <span class="st">"lawjames1"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expire_user_project_rights.html">expire_user_project_rights</a></span><span class="op">(</span></span>
<span>  conn <span class="op">=</span> <span class="va">conn</span>,</span>
<span>  project_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">26</span>, <span class="fl">31</span>, <span class="fl">34</span>, <span class="fl">45</span>, <span class="fl">62</span>, <span class="fl">65</span>, <span class="fl">27</span>, <span class="fl">33</span>, <span class="fl">40</span>, <span class="fl">41</span>, <span class="fl">73</span><span class="op">)</span>,</span>
<span>  all_users_except <span class="op">=</span> <span class="va">all_users_except</span>,</span>
<span>  expiration_date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">today</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">ddays</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/log_job_success.html">log_job_success</a></span><span class="op">(</span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>And here’s the entire <code>redcap_server.env</code> file, but make
sure you adapt this to your environment:</p>
<pre><code>REDCAP_DB_PORT=3306
REDCAP_DB_NAME=redcap
REDCAP_DB_HOST=127.0.0.1
REDCAP_DB_USER=redcap
REDCAP_DB_PASSWORD=redcap123

LOG_DB_NAME=rcc_log
LOG_DB_HOST=127.0.0.1
LOG_DB_USER=rcc_log
LOG_DB_PASSWORD=password
LOG_DB_PORT=13306</code></pre>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Philip Chase, Laurence James-Woodley, Kyle Chesney, Michael Bentz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
